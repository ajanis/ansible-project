---
- name: Create Tower inventories
  awx.awx.tower_inventory:
    name: "{{ item.name }}"
    description: "{{ item.description }}"
    organization: "Default"
    variables: "{{ item.variables }}"
    state: "{{ item.state | default('present') }}"
    validate_certs: no
    tower_host: "{{ awx_web_url }}"
    tower_username: "{{ awx_admin_user }}"
    tower_password: "{{ awx_admin_password }}"
  loop: "{{ tower_inventories }}"
  when:
    - tower_inventories is defined
    - tower_inventories != None

- name: Add hosts to Tower
  awx.awx.tower_host:
    name: "{{ item.name }}"
    description: "{{ item.description }}"
    inventory: "{{ item.inventory }}"
    variables: "{{ item.variables | default({}) }}"
    state: "{{ item.state | default('present') }}"
    validate_certs: no
    tower_host: "{{ awx_web_url }}"
    tower_username: "{{ awx_admin_user }}"
    tower_password: "{{ awx_admin_password }}"
  loop: "{{ tower_hosts }}"
  when:
    - tower_hosts is defined
    - tower_hosts != None

- name: Add inventory groups to Tower
  awx.awx.tower_group:
    name: "{{ item.name }}"
    description: "{{ item.description }}"
    inventory: "{{ item.inventory }}"
    source: "{{ item.source }}"
    instance_filters: "{{ item.instance_filters }}"
    state: "{{ item.state | default('present') }}"
    validate_certs: no
    tower_host: "{{ awx_web_url }}"
    tower_username: "{{ awx_admin_user }}"
    tower_password: "{{ awx_admin_password }}"
  loop: "{{ tower_groups }}"
  when:
    - tower_groups is defined
    - tower_groups != None

#- name: Add tower inventory
#  awx.awx.tower_inventory:
#    name: "build-servers"
#    description: "Intel NUC Build Servers"
#    organization: "Default"
#    variables: "{{ lookup('file', playbook_dir + '/extra_vars.yml') }}"
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
#
#- name: Add tower inventory
#  awx.awx.tower_inventory:
#    name: "build-masters"
#    description: "Build Master"
#    organization: "Default"
#    variables: "{{ lookup('file',  playbook_dir + '/extra_vars.yml') }}"
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
#
#- name: Add local build server to tower inventory
#  awx.awx.tower_host:
#    name: "{{ ansible_fqdn }}"
#    description: "Build-Master"
#    inventory: "build-masters"
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
#    variables:
#      ansible_ssh_host: "{{ ansible_default_ipv4.address }}"
#      ansible_python_interpreter: "/usr/bin/env python3"
#
#
#- name: Add Build Servers to tower inventory
#  awx.awx.tower_host:
#    name: "{{ item.value.name }}"
#    description: "Build-Server {{ item.value.name }}"
#    inventory: "build-servers"
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
#    variables:
#      ansible_ssh_host: "{{ item.value.ip }}"
#      ansible_python_interpreter: "/usr/bin/env python3"
#  loop: "{{ foreman_hosts | dict2items }}"
#
#
#- name: Add buildmaster group to tower inventory
#  awx.awx.tower_group:
#    name: buildmaster
#    description: "Build Master"
#    inventory: "build-masters"
#    source: manual
#    instance_filters: "{{ ansible_fqdn }}"
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
#
#
#- name: Add buildhost group to tower inventory
#  awx.awx.tower_group:
#    name: buildhost
#    description: "Intel NUC Build Hosts"
#    inventory: "build-servers"
#    instance_filters: 'buildserver*'
#    source: manual
#    state: present
#    validate_certs: no
#    tower_host: "{{ awx_web_url }}"
#    tower_username: "{{ awx_admin_user }}"
#    tower_password: "{{ awx_admin_password }}"
